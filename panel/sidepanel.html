<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>SupaExplorer - Supabase Database Explorer</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="app-header">
      <div class="header-main">
        <img src="supabase-database-explorer.svg" alt="Supabase Database Explorer logo" class="app-logo" />
        <h1>SupaExplorer</h1>
        <div class="header-actions">
          <button id="status-check-btn" class="theme-toggle" type="button" aria-label="Cloud status">
            <span class="header-action-icon status-check-icon" data-status="disconnected">
              <svg class="status-icon-disconnected" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"/><line x1="48" y1="40" x2="208" y2="216" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><path d="M193.89,200.49A79.66,79.66,0,0,1,160,208H72A56,56,0,1,1,85.92,97.74" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><path d="M112.63,63.52A80,80,0,0,1,219.68,181.28" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><path d="M80,128A79.68,79.68,0,0,1,91.07,87.37" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg>
              <svg class="status-icon-linked" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"/><path d="M80,128a80,80,0,1,1,80,80H72A56,56,0,1,1,85.92,97.74" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><polyline points="120 136 144 160 192 112" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg>
            </span>
          </button>
          <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
            <span class="theme-icon" data-theme="dark">
              <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
                <rect width="256" height="256" fill="none" />
                <line x1="128" y1="40" x2="128" y2="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
                <circle cx="128" cy="128" r="56" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
                <line x1="64" y1="64" x2="48" y2="48" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
                <line x1="64" y1="192" x2="48" y2="208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
                <line x1="192" y1="64" x2="208" y2="48" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
                <line x1="192" y1="192" x2="208" y2="208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
                <line x1="40" y1="128" x2="16" y2="128" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
                <line x1="128" y1="216" x2="128" y2="240" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
                <line x1="216" y1="128" x2="240" y2="128" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
              </svg>
              <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
                <rect width="256" height="256" fill="none" />
                <path d="M108.11,28.11A96.09,96.09,0,0,0,227.89,147.89,96,96,0,1,1,108.11,28.11Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
              </svg>
            </span>
          </button>
        </div>
      </div>
      <div id="connection-status" class="status status-idle">Idle</div>
    </header>

    <main>
      <section class="card">
        <h2>Connection</h2>
        <form id="connection-form">
          <label class="input-group">
            <span>Supabase Project ID</span>
            <input id="project-id" type="text" placeholder="xgtestzovibesvcoders" autocomplete="off" />
          </label>

          <label class="input-group">
            <span>Schema (Accept-Profile)</span>
            <input id="schema" type="text" placeholder="public" value="public" />
          </label>

          <label class="input-group">
            <span>apiKey</span>
            <input id="api-key" type="password" placeholder="Anon/service key" autocomplete="off" />
          </label>

          <label class="input-group">
            <span>Bearer token</span>
            <input id="bearer" type="password" placeholder="Defaults to apiKey when empty" autocomplete="off" />
          </label>

          <div class="form-actions">
            <button id="connect-btn" type="submit" class="primary">Connect / Refresh</button>
            <button id="clear-storage-btn" type="button">Clear</button>
          </div>
        </form>
        <div class="hint">
          Tip: Use anon key for read-only tables. Keep service_role keys out of shared environments.
        </div>
      </section>

      <section class="card">
        <div class="section-header">
          <h2>Tables / Views</h2>
          <div class="header-actions">
            <button id="report-btn" type="button" class="primary">Generate Security Report</button>
          </div>
        </div>
        <div class="tables-container">
          <table class="tables-grid">
            <thead>
              <tr>
                <th scope="col">Table</th>
                <th scope="col">Rows</th>
              </tr>
            </thead>
            <tbody id="tables-list">
              <tr class="tables-empty">
                <td colspan="2">Connect to populate tables.</td>
              </tr>
            </tbody>
          </table>
        </div>
        <p class="hint">Double-click a table to open it. Reload to refresh schema and counts.</p>
      </section>
    </main>

    <footer class="app-footer">
      <a class="torito-link" href="https://torito.io" target="_blank" rel="noopener noreferrer">
        <img src="https://torito.io/torito.svg" alt="Torito" class="torito-logo" />
        <span>Torito - Security &amp; Privacy Tools</span>
      </a>
      <div class="footer-links">
        <button type="button" class="link-button" id="terms-open-btn">Terms &amp; Conditions</button>
        <button type="button" class="link-button" id="terms-withdraw-btn">Withdraw consent</button>
      </div>
    </footer>

    <div class="link-modal hidden" id="link-modal" role="dialog" aria-modal="true" aria-labelledby="link-modal-title">
      <div class="link-modal-backdrop" id="link-modal-backdrop" tabindex="-1"></div>
      <div class="link-modal-container" role="document">
        <header class="link-modal-header">
          <div>
            <p class="link-modal-eyebrow">Cloud sync</p>
            <h2 id="link-modal-title">SupaExplorer Cloud link</h2>
            <!-- p class="link-modal-description">
              Tie this extension installation to your SupaExplorer Cloud seat to manage teams and billing centrally.
            </p -->
          </div>
          <button type="button" class="link-modal-close" id="link-modal-close-btn" aria-label="Close status panel">&times;</button>
        </header>
        <div class="link-modal-body">
          <div class="link-status-pill link-status-idle" id="link-status-pill">Status unknown</div>
          <p class="link-status-message" id="link-status-message">
            We’ll let you know once the extension reports its cloud status.
          </p>
          <dl class="link-status-meta hidden" id="link-status-meta">
            <div>
              <dt>Linked account</dt>
              <dd id="link-status-account">—</dd>
            </div>
            <div>
              <dt>Linked on</dt>
              <dd id="link-status-linked-at">—</dd>
            </div>
            <div>
              <dt>Extension ID</dt>
              <dd id="link-status-instance">—</dd>
            </div>
          </dl>
          <div class="link-team-picker" id="link-team-section">
            <div class="link-team-header">
              <div>
                <p class="link-team-label">Team destination</p>
                <p class="link-team-hint">Choose which team will receive cloud-shared reports.</p>
              </div>
              <button type="button" class="secondary link-team-refresh" id="link-team-refresh-btn" aria-label="Refresh teams list">
                <span class="link-team-refresh-icon" aria-hidden="true">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"/><polyline points="168 96 216 96 216 48" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><path d="M216,96,187.72,67.72A88,88,0,0,0,64,67" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><polyline points="88 160 40 160 40 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><path d="M40,160l28.28,28.28A88,88,0,0,0,192,189" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg>
                </span>
                <span>Update</span>
              </button>
            </div>
            <label class="link-team-control" for="link-team-select">
              <span class="link-team-control-label">Select team</span>
              <select id="link-team-select" name="link-team-select">
                <option value="">Link to SupaExplorer Cloud to load teams</option>
              </select>
            </label>
            <p class="link-team-status" id="link-team-status">Select a team to decide where reports are stored.</p>
          </div>
        </div>
        <div class="link-modal-actions">
          <button type="button" class="primary" id="link-connect-btn">Connect</button>
          <button type="button" class="secondary hidden" id="link-manage-btn">Manage in Cloud</button>
          <button type="button" class="danger hidden" id="link-disconnect-btn">Disconnect</button>
        </div>
        <p class="link-modal-footnote">
          Seats are enforced per user. Linking this device revokes any previous extension connected to the same account.
        </p>
      </div>
    </div>

    <div class="share-report-modal hidden" id="share-report-modal" role="dialog" aria-modal="true" aria-labelledby="share-report-title">
      <div class="share-report-backdrop" id="share-report-backdrop" tabindex="-1"></div>
      <div class="share-report-container" role="document">
        <header class="share-report-header">
          <div>
            <p class="share-report-eyebrow">Security report</p>
            <h2 id="share-report-title">What would you like to do?</h2>
            <p class="share-report-description">Generate a fresh local report now or get ready to share it once available.</p>
          </div>
          <button type="button" class="share-report-close" id="share-report-close-btn" aria-label="Close share report options">&times;</button>
        </header>
        <div class="share-report-actions">
          <button type="button" class="primary share-report-view" id="share-report-view-btn">
            <span class="share-report-action-icon" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
                <rect width="256" height="256" fill="none" />
                <path d="M200,224H56a8,8,0,0,1-8-8V40a8,8,0,0,1,8-8h96l56,56V216A8,8,0,0,1,200,224Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
                <polyline points="152 32 152 88 208 88" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
              </svg>
            </span>
            <span>View Report</span>
          </button>
          <button type="button" class="secondary share-report-share" id="share-report-share-btn" aria-live="polite">
            <span class="share-report-action-icon" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
                <rect width="256" height="256" fill="none" />
                <path d="M80,128a80,80,0,1,1,80,80H72A56,56,0,1,1,85.92,97.74" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
              </svg>
            </span>
            <span>Share to Cloud</span>
          </button>
          <button type="button" class="secondary share-report-connect hidden" id="share-report-connect-btn">
            <span class="share-report-action-icon" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
                <rect width="256" height="256" fill="none" />
                <line x1="24" y1="128" x2="136" y2="128" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
                <polyline points="96 88 136 128 96 168" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
                <polyline points="136 40 200 40 200 216 136 216" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" />
              </svg>
            </span>
            <span>Connect to Cloud</span>
          </button>
        </div>
        <p class="share-report-note" id="share-report-note">Link this extension to SupaExplorer Cloud to sync reports with your team.</p>
        <div class="share-report-link hidden" id="share-report-link">
          <span class="share-report-link-text" id="share-report-link-text"></span>
          <button type="button" class="share-report-copy-btn" id="share-report-copy-btn">Click to copy</button>
        </div>
      </div>
    </div>

    <div class="terms-modal hidden" id="terms-modal" role="dialog" aria-modal="true" aria-labelledby="terms-title">
      <div class="terms-backdrop" id="terms-backdrop" tabindex="-1"></div>
      <div class="terms-container" role="document">
        <header class="terms-header">
          <h2 id="terms-title">SupaExplorer Terms &amp; Conditions</h2>
          <p class="terms-meta">Version 1.0 &bull; Effective November 5, 2025</p>
          <p class="terms-summary">
            Please review and accept these Terms to use the SupaExplorer browser extension. You can revisit them at any
            time from the footer and withdraw consent whenever you choose.
          </p>
        </header>
        <div class="terms-body" tabindex="0">
          <ol class="terms-list">
            <li>
              <h3>1. Eligibility and Acceptance</h3>
              <p>
                By selecting “Accept” or using the SupaExplorer extension (“Extension”), you confirm you are at least the
                age of majority in your jurisdiction and, if acting for an organization, that you have authority to bind
                it. If you disagree with these Terms, do not install or use the Extension.
              </p>
            </li>
            <li>
              <h3>2. Changes to the Terms</h3>
              <p>
                We may update these Terms by notifying you through the Extension or the distribution platform. Continued
                use after an update takes effect constitutes acceptance. If you do not agree to the revised Terms, uninstall
                or disable the Extension.
              </p>
            </li>
            <li>
              <h3>3. License Grant</h3>
              <p>
                Torito.io, and SupaExplorer.com (“Torito”, "SupaExplorer", “we”, “us”) grants you a revocable, non-exclusive, non-transferable license to
                install and use the Extension solely to manage your Supabase projects.
              </p>
            </li>
            <li>
              <h3>4. Restrictions</h3>
              <p>
                You agree not to reverse engineer, decompile, or disassemble the Extension except where permitted by law,
                bypass security controls, misuse it to violate third-party rights, sublicense, or deploy it in
                safety-critical environments where failure could cause harm.
              </p>
            </li>
            <li>
              <h3>5. User Responsibilities</h3>
              <p>
                You are solely responsible for database permissions, backups, disaster recovery, and ensuring your use of
                the Extension complies with all applicable laws and third-party terms (including Supabase).
                Actions taken through the Extension can modify or delete data irreversibly.
              </p>
            </li>
            <li>
              <h3>6. Data Handling and Privacy</h3>
              <p>
                The Extension interacts with Supabase services you authorize. We do not persist credentials or
                database content on our servers unless described in a separate privacy notice, which is incorporated by
                reference. Review the Privacy Policy before use.
              </p>
            </li>
            <li>
              <h3>7. Third-Party Services</h3>
              <p>
                Third-party services (Supabase, GitHub, analytics, etc.) have their own terms and availability. We do not
                control or guarantee those services and are not responsible for outages or changes on their side.
              </p>
            </li>
            <li>
              <h3>8. No Professional Advice</h3>
              <p>
                The Extension provides tooling and automation only. It does not constitute legal, financial, security, or
                other professional advice. Consult qualified professionals for critical decisions.
              </p>
            </li>
            <li>
              <h3>9. Warranty Disclaimer</h3>
              <p>
                The Extension is provided “as is” and “as available.” To the fullest extent permitted by law, we disclaim
                all warranties, including implied warranties of merchantability, fitness for a particular purpose, title,
                and non-infringement.
              </p>
            </li>
            <li>
              <h3>10. Limitation of Liability</h3>
              <p>
                To the maximum extent permitted by law, Torito is not liable for indirect, incidental, consequential, or
                punitive damages, or for lost profits, data, or business. Aggregate liability is limited to EUR 50 or the
                amount you paid (if any) for the Extension in the prior 12 months, whichever is greater.
              </p>
            </li>
            <li>
              <h3>11. Indemnification</h3>
              <p>
                You agree to defend, indemnify, and hold harmless Torito and its personnel from claims arising from your
                misuse of the Extension, breach of these Terms, or violation of applicable law.
              </p>
            </li>
            <li>
              <h3>12. User Control and Extension Availability</h3>
              <p>
                You may disable or uninstall the Extension at any time via your browser. We cannot remotely alter or
                terminate your installed copy. Some features may rely on Torito-operated services whose discontinuation
                could affect functionality.
              </p>
            </li>
            <li>
              <h3>13. Export Compliance</h3>
              <p>
                You must comply with all applicable export and sanctions laws. You represent you are not located in, or a
                resident of, any jurisdiction embargoed by the European Union or the United States and are not on any
                government restricted parties list.
              </p>
            </li>
            <li>
              <h3>14. Governing Law and Venue</h3>
              <p>
                These Terms are governed by the laws of the Federal Republic of Germany. The courts of Berlin, Germany have
                exclusive jurisdiction over disputes arising from the Terms.
              </p>
            </li>
            <li>
              <h3>15. Miscellaneous</h3>
              <p>
                These Terms constitute the entire agreement regarding the Extension. If any provision is unenforceable, the
                remaining provisions remain in effect. You may not assign these Terms without our written consent. We may
                assign them in connection with a merger, acquisition, or asset transfer.
              </p>
            </li>
            <li>
              <h3>16. Contact</h3>
              <p>
                Questions or legal notices should be sent to <a href="mailto:support@torito.io">support@torito.io</a>.
              </p>
            </li>
          </ol>
        </div>
        <footer class="terms-footer">
          <div class="terms-footnote" id="terms-footnote">
            Declining disables the Extension. To resume, reopen the side panel and accept the Terms.
          </div>
          <div class="terms-buttons">
            <button type="button" id="terms-close-btn" class="secondary hidden">Close</button>
            <button type="button" id="terms-decline-btn" class="secondary">Decline</button>
            <button type="button" id="terms-accept-btn" class="primary">Accept</button>
          </div>
        </footer>
      </div>
    </div>

    <script type="module" src="sidepanel.js"></script>
  </body>
</html>
